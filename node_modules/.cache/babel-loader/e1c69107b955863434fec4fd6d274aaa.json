{"ast":null,"code":"var _core = require(\"./core\");\n\nvar createElement = _core.createElement;\n\nvar PathProxy = require(\"../core/PathProxy\");\n\nvar BoundingRect = require(\"../core/BoundingRect\");\n\nvar textContain = require(\"../contain/text\");\n\nvar textHelper = require(\"../graphic/helper/text\");\n\nvar Text = require(\"../graphic/Text\"); // TODO\n// 1. shadow\n// 2. Image: sx, sy, sw, sh\n\n\nvar CMD = PathProxy.CMD;\nvar arrayJoin = Array.prototype.join;\nvar NONE = 'none';\nvar mathRound = Math.round;\nvar mathSin = Math.sin;\nvar mathCos = Math.cos;\nvar PI = Math.PI;\nvar PI2 = Math.PI * 2;\nvar degree = 180 / PI;\nvar EPSILON = 1e-4;\n\nfunction round4(val) {\n  return mathRound(val * 1e4) / 1e4;\n}\n\nfunction isAroundZero(val) {\n  return val < EPSILON && val > -EPSILON;\n}\n\nfunction pathHasFill(style, isText) {\n  var fill = isText ? style.textFill : style.fill;\n  return fill != null && fill !== NONE;\n}\n\nfunction pathHasStroke(style, isText) {\n  var stroke = isText ? style.textStroke : style.stroke;\n  return stroke != null && stroke !== NONE;\n}\n\nfunction setTransform(svgEl, m) {\n  if (m) {\n    attr(svgEl, 'transform', 'matrix(' + arrayJoin.call(m, ',') + ')');\n  }\n}\n\nfunction attr(el, key, val) {\n  if (!val || val.type !== 'linear' && val.type !== 'radial') {\n    // Don't set attribute for gradient, since it need new dom nodes\n    el.setAttribute(key, val);\n  }\n}\n\nfunction attrXLink(el, key, val) {\n  el.setAttributeNS('http://www.w3.org/1999/xlink', key, val);\n}\n\nfunction bindStyle(svgEl, style, isText) {\n  if (pathHasFill(style, isText)) {\n    var fill = isText ? style.textFill : style.fill;\n    fill = fill === 'transparent' ? NONE : fill;\n    /**\n     * FIXME:\n     * This is a temporary fix for Chrome's clipping bug\n     * that happens when a clip-path is referring another one.\n     * This fix should be used before Chrome's bug is fixed.\n     * For an element that has clip-path, and fill is none,\n     * set it to be \"rgba(0, 0, 0, 0.002)\" will hide the element.\n     * Otherwise, it will show black fill color.\n     * 0.002 is used because this won't work for alpha values smaller\n     * than 0.002.\n     *\n     * See\n     * https://bugs.chromium.org/p/chromium/issues/detail?id=659790\n     * for more information.\n     */\n\n    if (svgEl.getAttribute('clip-path') !== 'none' && fill === NONE) {\n      fill = 'rgba(0, 0, 0, 0.002)';\n    }\n\n    attr(svgEl, 'fill', fill);\n    attr(svgEl, 'fill-opacity', style.opacity);\n  } else {\n    attr(svgEl, 'fill', NONE);\n  }\n\n  if (pathHasStroke(style, isText)) {\n    var stroke = isText ? style.textStroke : style.stroke;\n    stroke = stroke === 'transparent' ? NONE : stroke;\n    attr(svgEl, 'stroke', stroke);\n    var strokeWidth = isText ? style.textStrokeWidth : style.lineWidth;\n    var strokeScale = style.strokeNoScale ? style.host.getLineScale() : 1;\n    attr(svgEl, 'stroke-width', strokeWidth / strokeScale);\n    attr(svgEl, 'paint-order', 'stroke');\n    attr(svgEl, 'stroke-opacity', style.opacity);\n    var lineDash = style.lineDash;\n\n    if (lineDash) {\n      attr(svgEl, 'stroke-dasharray', style.lineDash.join(','));\n      attr(svgEl, 'stroke-dashoffset', mathRound(style.lineDashOffset || 0));\n    } else {\n      attr(svgEl, 'stroke-dasharray', '');\n    } // PENDING\n\n\n    style.lineCap && attr(svgEl, 'stroke-linecap', style.lineCap);\n    style.lineJoin && attr(svgEl, 'stroke-linejoin', style.lineJoin);\n    style.miterLimit && attr(svgEl, 'stroke-miterlimit', style.miterLimit);\n  } else {\n    attr(svgEl, 'stroke', NONE);\n  }\n}\n/***************************************************\n * PATH\n **************************************************/\n\n\nfunction pathDataToString(path) {\n  var str = [];\n  var data = path.data;\n  var dataLength = path.len();\n\n  for (var i = 0; i < dataLength;) {\n    var cmd = data[i++];\n    var cmdStr = '';\n    var nData = 0;\n\n    switch (cmd) {\n      case CMD.M:\n        cmdStr = 'M';\n        nData = 2;\n        break;\n\n      case CMD.L:\n        cmdStr = 'L';\n        nData = 2;\n        break;\n\n      case CMD.Q:\n        cmdStr = 'Q';\n        nData = 4;\n        break;\n\n      case CMD.C:\n        cmdStr = 'C';\n        nData = 6;\n        break;\n\n      case CMD.A:\n        var cx = data[i++];\n        var cy = data[i++];\n        var rx = data[i++];\n        var ry = data[i++];\n        var theta = data[i++];\n        var dTheta = data[i++];\n        var psi = data[i++];\n        var clockwise = data[i++];\n        var dThetaPositive = Math.abs(dTheta);\n        var isCircle = isAroundZero(dThetaPositive % PI2) && !isAroundZero(dThetaPositive);\n        var large = false;\n\n        if (dThetaPositive >= PI2) {\n          large = true;\n        } else if (isAroundZero(dThetaPositive)) {\n          large = false;\n        } else {\n          large = (dTheta > -PI && dTheta < 0 || dTheta > PI) === !!clockwise;\n        }\n\n        var x0 = round4(cx + rx * mathCos(theta));\n        var y0 = round4(cy + ry * mathSin(theta)); // It will not draw if start point and end point are exactly the same\n        // We need to shift the end point with a small value\n        // FIXME A better way to draw circle ?\n\n        if (isCircle) {\n          if (clockwise) {\n            dTheta = PI2 - 1e-4;\n          } else {\n            dTheta = -PI2 + 1e-4;\n          }\n\n          large = true;\n\n          if (i === 9) {\n            // Move to (x0, y0) only when CMD.A comes at the\n            // first position of a shape.\n            // For instance, when drawing a ring, CMD.A comes\n            // after CMD.M, so it's unnecessary to move to\n            // (x0, y0).\n            str.push('M', x0, y0);\n          }\n        }\n\n        var x = round4(cx + rx * mathCos(theta + dTheta));\n        var y = round4(cy + ry * mathSin(theta + dTheta)); // FIXME Ellipse\n\n        str.push('A', round4(rx), round4(ry), mathRound(psi * degree), +large, +clockwise, x, y);\n        break;\n\n      case CMD.Z:\n        cmdStr = 'Z';\n        break;\n\n      case CMD.R:\n        var x = round4(data[i++]);\n        var y = round4(data[i++]);\n        var w = round4(data[i++]);\n        var h = round4(data[i++]);\n        str.push('M', x, y, 'L', x + w, y, 'L', x + w, y + h, 'L', x, y + h, 'L', x, y);\n        break;\n    }\n\n    cmdStr && str.push(cmdStr);\n\n    for (var j = 0; j < nData; j++) {\n      // PENDING With scale\n      str.push(round4(data[i++]));\n    }\n  }\n\n  return str.join(' ');\n}\n\nvar svgPath = {};\n\nsvgPath.brush = function (el) {\n  var style = el.style;\n  var svgEl = el.__svgEl;\n\n  if (!svgEl) {\n    svgEl = createElement('path');\n    el.__svgEl = svgEl;\n  }\n\n  if (!el.path) {\n    el.createPathProxy();\n  }\n\n  var path = el.path;\n\n  if (el.__dirtyPath) {\n    path.beginPath();\n    el.buildPath(path, el.shape);\n    el.__dirtyPath = false;\n    var pathStr = pathDataToString(path);\n\n    if (pathStr.indexOf('NaN') < 0) {\n      // Ignore illegal path, which may happen such in out-of-range\n      // data in Calendar series.\n      attr(svgEl, 'd', pathStr);\n    }\n  }\n\n  bindStyle(svgEl, style);\n  setTransform(svgEl, el.transform);\n\n  if (style.text != null) {\n    svgTextDrawRectText(el, el.getBoundingRect());\n  }\n};\n/***************************************************\n * IMAGE\n **************************************************/\n\n\nvar svgImage = {};\n\nsvgImage.brush = function (el) {\n  var style = el.style;\n  var image = style.image;\n\n  if (image instanceof HTMLImageElement) {\n    var src = image.src;\n    image = src;\n  }\n\n  if (!image) {\n    return;\n  }\n\n  var x = style.x || 0;\n  var y = style.y || 0;\n  var dw = style.width;\n  var dh = style.height;\n  var svgEl = el.__svgEl;\n\n  if (!svgEl) {\n    svgEl = createElement('image');\n    el.__svgEl = svgEl;\n  }\n\n  if (image !== el.__imageSrc) {\n    attrXLink(svgEl, 'href', image); // Caching image src\n\n    el.__imageSrc = image;\n  }\n\n  attr(svgEl, 'width', dw);\n  attr(svgEl, 'height', dh);\n  attr(svgEl, 'x', x);\n  attr(svgEl, 'y', y);\n  setTransform(svgEl, el.transform);\n\n  if (style.text != null) {\n    svgTextDrawRectText(el, el.getBoundingRect());\n  }\n};\n/***************************************************\n * TEXT\n **************************************************/\n\n\nvar svgText = {};\nvar tmpRect = new BoundingRect();\n\nvar svgTextDrawRectText = function (el, rect, textRect) {\n  var style = el.style;\n  el.__dirty && textHelper.normalizeTextStyle(style, true);\n  var text = style.text; // Convert to string\n\n  if (text == null) {\n    // Draw no text only when text is set to null, but not ''\n    return;\n  } else {\n    text += '';\n  }\n\n  var textSvgEl = el.__textSvgEl;\n\n  if (!textSvgEl) {\n    textSvgEl = createElement('text');\n    el.__textSvgEl = textSvgEl;\n  }\n\n  bindStyle(textSvgEl, style, true);\n\n  if (el instanceof Text || el.style.transformText) {\n    // Transform text with element\n    setTransform(textSvgEl, el.transform);\n  } else {\n    if (el.transform) {\n      tmpRect.copy(rect);\n      tmpRect.applyTransform(el.transform);\n      rect = tmpRect;\n    } else {\n      var pos = el.transformCoordToGlobal(rect.x, rect.y);\n      rect.x = pos[0];\n      rect.y = pos[1];\n    }\n  }\n\n  var x;\n  var y;\n  var textPosition = style.textPosition;\n  var distance = style.textDistance;\n  var align = style.textAlign || 'left';\n\n  if (typeof style.fontSize === 'number') {\n    style.fontSize += 'px';\n  }\n\n  var font = style.font || [style.fontStyle || '', style.fontWeight || '', style.fontSize || '', style.fontFamily || ''].join(' ') || textContain.DEFAULT_FONT;\n  var verticalAlign = getVerticalAlignForSvg(style.textVerticalAlign);\n  textRect = textContain.getBoundingRect(text, font, align, verticalAlign);\n  var lineHeight = textRect.lineHeight; // Text position represented by coord\n\n  if (textPosition instanceof Array) {\n    x = rect.x + textPosition[0];\n    y = rect.y + textPosition[1];\n  } else {\n    var newPos = textContain.adjustTextPositionOnRect(textPosition, rect, distance);\n    x = newPos.x;\n    y = newPos.y;\n    verticalAlign = getVerticalAlignForSvg(newPos.textVerticalAlign);\n    align = newPos.textAlign;\n  }\n\n  attr(textSvgEl, 'alignment-baseline', verticalAlign);\n\n  if (font) {\n    textSvgEl.style.font = font;\n  }\n\n  var textPadding = style.textPadding; // Make baseline top\n\n  attr(textSvgEl, 'x', x);\n  attr(textSvgEl, 'y', y);\n  var textLines = text.split('\\n');\n  var nTextLines = textLines.length;\n  var textAnchor = align; // PENDING\n\n  if (textAnchor === 'left') {\n    textAnchor = 'start';\n    textPadding && (x += textPadding[3]);\n  } else if (textAnchor === 'right') {\n    textAnchor = 'end';\n    textPadding && (x -= textPadding[1]);\n  } else if (textAnchor === 'center') {\n    textAnchor = 'middle';\n    textPadding && (x += (textPadding[3] - textPadding[1]) / 2);\n  }\n\n  var dy = 0;\n\n  if (verticalAlign === 'baseline') {\n    dy = -textRect.height + lineHeight;\n    textPadding && (dy -= textPadding[2]);\n  } else if (verticalAlign === 'middle') {\n    dy = (-textRect.height + lineHeight) / 2;\n    textPadding && (y += (textPadding[0] - textPadding[2]) / 2);\n  } else {\n    textPadding && (dy += textPadding[0]);\n  } // Font may affect position of each tspan elements\n\n\n  if (el.__text !== text || el.__textFont !== font) {\n    var tspanList = el.__tspanList || [];\n    el.__tspanList = tspanList;\n\n    for (var i = 0; i < nTextLines; i++) {\n      // Using cached tspan elements\n      var tspan = tspanList[i];\n\n      if (!tspan) {\n        tspan = tspanList[i] = createElement('tspan');\n        textSvgEl.appendChild(tspan);\n        attr(tspan, 'alignment-baseline', verticalAlign);\n        attr(tspan, 'text-anchor', textAnchor);\n      } else {\n        tspan.innerHTML = '';\n      }\n\n      attr(tspan, 'x', x);\n      attr(tspan, 'y', y + i * lineHeight + dy);\n      tspan.appendChild(document.createTextNode(textLines[i]));\n    } // Remove unsed tspan elements\n\n\n    for (; i < tspanList.length; i++) {\n      textSvgEl.removeChild(tspanList[i]);\n    }\n\n    tspanList.length = nTextLines;\n    el.__text = text;\n    el.__textFont = font;\n  } else if (el.__tspanList.length) {\n    // Update span x and y\n    var len = el.__tspanList.length;\n\n    for (var i = 0; i < len; ++i) {\n      var tspan = el.__tspanList[i];\n\n      if (tspan) {\n        attr(tspan, 'x', x);\n        attr(tspan, 'y', y + i * lineHeight + dy);\n      }\n    }\n  }\n};\n\nfunction getVerticalAlignForSvg(verticalAlign) {\n  if (verticalAlign === 'middle') {\n    return 'middle';\n  } else if (verticalAlign === 'bottom') {\n    return 'baseline';\n  } else {\n    return 'hanging';\n  }\n}\n\nsvgText.drawRectText = svgTextDrawRectText;\n\nsvgText.brush = function (el) {\n  var style = el.style;\n\n  if (style.text != null) {\n    // 强制设置 textPosition\n    style.textPosition = [0, 0];\n    svgTextDrawRectText(el, {\n      x: style.x || 0,\n      y: style.y || 0,\n      width: 0,\n      height: 0\n    }, el.getBoundingRect());\n  }\n};\n\nexports.path = svgPath;\nexports.image = svgImage;\nexports.text = svgText;","map":{"version":3,"sources":["/home/martin/Escritorio/Taller de Integracion/Tarea3-TallerDeIntegracion/node_modules/react-echarts/node_modules/zrender/lib/svg/graphic.js"],"names":["_core","require","createElement","PathProxy","BoundingRect","textContain","textHelper","Text","CMD","arrayJoin","Array","prototype","join","NONE","mathRound","Math","round","mathSin","sin","mathCos","cos","PI","PI2","degree","EPSILON","round4","val","isAroundZero","pathHasFill","style","isText","fill","textFill","pathHasStroke","stroke","textStroke","setTransform","svgEl","m","attr","call","el","key","type","setAttribute","attrXLink","setAttributeNS","bindStyle","getAttribute","opacity","strokeWidth","textStrokeWidth","lineWidth","strokeScale","strokeNoScale","host","getLineScale","lineDash","lineDashOffset","lineCap","lineJoin","miterLimit","pathDataToString","path","str","data","dataLength","len","i","cmd","cmdStr","nData","M","L","Q","C","A","cx","cy","rx","ry","theta","dTheta","psi","clockwise","dThetaPositive","abs","isCircle","large","x0","y0","push","x","y","Z","R","w","h","j","svgPath","brush","__svgEl","createPathProxy","__dirtyPath","beginPath","buildPath","shape","pathStr","indexOf","transform","text","svgTextDrawRectText","getBoundingRect","svgImage","image","HTMLImageElement","src","dw","width","dh","height","__imageSrc","svgText","tmpRect","rect","textRect","__dirty","normalizeTextStyle","textSvgEl","__textSvgEl","transformText","copy","applyTransform","pos","transformCoordToGlobal","textPosition","distance","textDistance","align","textAlign","fontSize","font","fontStyle","fontWeight","fontFamily","DEFAULT_FONT","verticalAlign","getVerticalAlignForSvg","textVerticalAlign","lineHeight","newPos","adjustTextPositionOnRect","textPadding","textLines","split","nTextLines","length","textAnchor","dy","__text","__textFont","tspanList","__tspanList","tspan","appendChild","innerHTML","document","createTextNode","removeChild","drawRectText","exports"],"mappings":"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","sourcesContent":["var _core = require(\"./core\");\n\nvar createElement = _core.createElement;\n\nvar PathProxy = require(\"../core/PathProxy\");\n\nvar BoundingRect = require(\"../core/BoundingRect\");\n\nvar textContain = require(\"../contain/text\");\n\nvar textHelper = require(\"../graphic/helper/text\");\n\nvar Text = require(\"../graphic/Text\");\n\n// TODO\n// 1. shadow\n// 2. Image: sx, sy, sw, sh\nvar CMD = PathProxy.CMD;\nvar arrayJoin = Array.prototype.join;\nvar NONE = 'none';\nvar mathRound = Math.round;\nvar mathSin = Math.sin;\nvar mathCos = Math.cos;\nvar PI = Math.PI;\nvar PI2 = Math.PI * 2;\nvar degree = 180 / PI;\nvar EPSILON = 1e-4;\n\nfunction round4(val) {\n  return mathRound(val * 1e4) / 1e4;\n}\n\nfunction isAroundZero(val) {\n  return val < EPSILON && val > -EPSILON;\n}\n\nfunction pathHasFill(style, isText) {\n  var fill = isText ? style.textFill : style.fill;\n  return fill != null && fill !== NONE;\n}\n\nfunction pathHasStroke(style, isText) {\n  var stroke = isText ? style.textStroke : style.stroke;\n  return stroke != null && stroke !== NONE;\n}\n\nfunction setTransform(svgEl, m) {\n  if (m) {\n    attr(svgEl, 'transform', 'matrix(' + arrayJoin.call(m, ',') + ')');\n  }\n}\n\nfunction attr(el, key, val) {\n  if (!val || val.type !== 'linear' && val.type !== 'radial') {\n    // Don't set attribute for gradient, since it need new dom nodes\n    el.setAttribute(key, val);\n  }\n}\n\nfunction attrXLink(el, key, val) {\n  el.setAttributeNS('http://www.w3.org/1999/xlink', key, val);\n}\n\nfunction bindStyle(svgEl, style, isText) {\n  if (pathHasFill(style, isText)) {\n    var fill = isText ? style.textFill : style.fill;\n    fill = fill === 'transparent' ? NONE : fill;\n    /**\n     * FIXME:\n     * This is a temporary fix for Chrome's clipping bug\n     * that happens when a clip-path is referring another one.\n     * This fix should be used before Chrome's bug is fixed.\n     * For an element that has clip-path, and fill is none,\n     * set it to be \"rgba(0, 0, 0, 0.002)\" will hide the element.\n     * Otherwise, it will show black fill color.\n     * 0.002 is used because this won't work for alpha values smaller\n     * than 0.002.\n     *\n     * See\n     * https://bugs.chromium.org/p/chromium/issues/detail?id=659790\n     * for more information.\n     */\n\n    if (svgEl.getAttribute('clip-path') !== 'none' && fill === NONE) {\n      fill = 'rgba(0, 0, 0, 0.002)';\n    }\n\n    attr(svgEl, 'fill', fill);\n    attr(svgEl, 'fill-opacity', style.opacity);\n  } else {\n    attr(svgEl, 'fill', NONE);\n  }\n\n  if (pathHasStroke(style, isText)) {\n    var stroke = isText ? style.textStroke : style.stroke;\n    stroke = stroke === 'transparent' ? NONE : stroke;\n    attr(svgEl, 'stroke', stroke);\n    var strokeWidth = isText ? style.textStrokeWidth : style.lineWidth;\n    var strokeScale = style.strokeNoScale ? style.host.getLineScale() : 1;\n    attr(svgEl, 'stroke-width', strokeWidth / strokeScale);\n    attr(svgEl, 'paint-order', 'stroke');\n    attr(svgEl, 'stroke-opacity', style.opacity);\n    var lineDash = style.lineDash;\n\n    if (lineDash) {\n      attr(svgEl, 'stroke-dasharray', style.lineDash.join(','));\n      attr(svgEl, 'stroke-dashoffset', mathRound(style.lineDashOffset || 0));\n    } else {\n      attr(svgEl, 'stroke-dasharray', '');\n    } // PENDING\n\n\n    style.lineCap && attr(svgEl, 'stroke-linecap', style.lineCap);\n    style.lineJoin && attr(svgEl, 'stroke-linejoin', style.lineJoin);\n    style.miterLimit && attr(svgEl, 'stroke-miterlimit', style.miterLimit);\n  } else {\n    attr(svgEl, 'stroke', NONE);\n  }\n}\n/***************************************************\n * PATH\n **************************************************/\n\n\nfunction pathDataToString(path) {\n  var str = [];\n  var data = path.data;\n  var dataLength = path.len();\n\n  for (var i = 0; i < dataLength;) {\n    var cmd = data[i++];\n    var cmdStr = '';\n    var nData = 0;\n\n    switch (cmd) {\n      case CMD.M:\n        cmdStr = 'M';\n        nData = 2;\n        break;\n\n      case CMD.L:\n        cmdStr = 'L';\n        nData = 2;\n        break;\n\n      case CMD.Q:\n        cmdStr = 'Q';\n        nData = 4;\n        break;\n\n      case CMD.C:\n        cmdStr = 'C';\n        nData = 6;\n        break;\n\n      case CMD.A:\n        var cx = data[i++];\n        var cy = data[i++];\n        var rx = data[i++];\n        var ry = data[i++];\n        var theta = data[i++];\n        var dTheta = data[i++];\n        var psi = data[i++];\n        var clockwise = data[i++];\n        var dThetaPositive = Math.abs(dTheta);\n        var isCircle = isAroundZero(dThetaPositive % PI2) && !isAroundZero(dThetaPositive);\n        var large = false;\n\n        if (dThetaPositive >= PI2) {\n          large = true;\n        } else if (isAroundZero(dThetaPositive)) {\n          large = false;\n        } else {\n          large = (dTheta > -PI && dTheta < 0 || dTheta > PI) === !!clockwise;\n        }\n\n        var x0 = round4(cx + rx * mathCos(theta));\n        var y0 = round4(cy + ry * mathSin(theta)); // It will not draw if start point and end point are exactly the same\n        // We need to shift the end point with a small value\n        // FIXME A better way to draw circle ?\n\n        if (isCircle) {\n          if (clockwise) {\n            dTheta = PI2 - 1e-4;\n          } else {\n            dTheta = -PI2 + 1e-4;\n          }\n\n          large = true;\n\n          if (i === 9) {\n            // Move to (x0, y0) only when CMD.A comes at the\n            // first position of a shape.\n            // For instance, when drawing a ring, CMD.A comes\n            // after CMD.M, so it's unnecessary to move to\n            // (x0, y0).\n            str.push('M', x0, y0);\n          }\n        }\n\n        var x = round4(cx + rx * mathCos(theta + dTheta));\n        var y = round4(cy + ry * mathSin(theta + dTheta)); // FIXME Ellipse\n\n        str.push('A', round4(rx), round4(ry), mathRound(psi * degree), +large, +clockwise, x, y);\n        break;\n\n      case CMD.Z:\n        cmdStr = 'Z';\n        break;\n\n      case CMD.R:\n        var x = round4(data[i++]);\n        var y = round4(data[i++]);\n        var w = round4(data[i++]);\n        var h = round4(data[i++]);\n        str.push('M', x, y, 'L', x + w, y, 'L', x + w, y + h, 'L', x, y + h, 'L', x, y);\n        break;\n    }\n\n    cmdStr && str.push(cmdStr);\n\n    for (var j = 0; j < nData; j++) {\n      // PENDING With scale\n      str.push(round4(data[i++]));\n    }\n  }\n\n  return str.join(' ');\n}\n\nvar svgPath = {};\n\nsvgPath.brush = function (el) {\n  var style = el.style;\n  var svgEl = el.__svgEl;\n\n  if (!svgEl) {\n    svgEl = createElement('path');\n    el.__svgEl = svgEl;\n  }\n\n  if (!el.path) {\n    el.createPathProxy();\n  }\n\n  var path = el.path;\n\n  if (el.__dirtyPath) {\n    path.beginPath();\n    el.buildPath(path, el.shape);\n    el.__dirtyPath = false;\n    var pathStr = pathDataToString(path);\n\n    if (pathStr.indexOf('NaN') < 0) {\n      // Ignore illegal path, which may happen such in out-of-range\n      // data in Calendar series.\n      attr(svgEl, 'd', pathStr);\n    }\n  }\n\n  bindStyle(svgEl, style);\n  setTransform(svgEl, el.transform);\n\n  if (style.text != null) {\n    svgTextDrawRectText(el, el.getBoundingRect());\n  }\n};\n/***************************************************\n * IMAGE\n **************************************************/\n\n\nvar svgImage = {};\n\nsvgImage.brush = function (el) {\n  var style = el.style;\n  var image = style.image;\n\n  if (image instanceof HTMLImageElement) {\n    var src = image.src;\n    image = src;\n  }\n\n  if (!image) {\n    return;\n  }\n\n  var x = style.x || 0;\n  var y = style.y || 0;\n  var dw = style.width;\n  var dh = style.height;\n  var svgEl = el.__svgEl;\n\n  if (!svgEl) {\n    svgEl = createElement('image');\n    el.__svgEl = svgEl;\n  }\n\n  if (image !== el.__imageSrc) {\n    attrXLink(svgEl, 'href', image); // Caching image src\n\n    el.__imageSrc = image;\n  }\n\n  attr(svgEl, 'width', dw);\n  attr(svgEl, 'height', dh);\n  attr(svgEl, 'x', x);\n  attr(svgEl, 'y', y);\n  setTransform(svgEl, el.transform);\n\n  if (style.text != null) {\n    svgTextDrawRectText(el, el.getBoundingRect());\n  }\n};\n/***************************************************\n * TEXT\n **************************************************/\n\n\nvar svgText = {};\nvar tmpRect = new BoundingRect();\n\nvar svgTextDrawRectText = function (el, rect, textRect) {\n  var style = el.style;\n  el.__dirty && textHelper.normalizeTextStyle(style, true);\n  var text = style.text; // Convert to string\n\n  if (text == null) {\n    // Draw no text only when text is set to null, but not ''\n    return;\n  } else {\n    text += '';\n  }\n\n  var textSvgEl = el.__textSvgEl;\n\n  if (!textSvgEl) {\n    textSvgEl = createElement('text');\n    el.__textSvgEl = textSvgEl;\n  }\n\n  bindStyle(textSvgEl, style, true);\n\n  if (el instanceof Text || el.style.transformText) {\n    // Transform text with element\n    setTransform(textSvgEl, el.transform);\n  } else {\n    if (el.transform) {\n      tmpRect.copy(rect);\n      tmpRect.applyTransform(el.transform);\n      rect = tmpRect;\n    } else {\n      var pos = el.transformCoordToGlobal(rect.x, rect.y);\n      rect.x = pos[0];\n      rect.y = pos[1];\n    }\n  }\n\n  var x;\n  var y;\n  var textPosition = style.textPosition;\n  var distance = style.textDistance;\n  var align = style.textAlign || 'left';\n\n  if (typeof style.fontSize === 'number') {\n    style.fontSize += 'px';\n  }\n\n  var font = style.font || [style.fontStyle || '', style.fontWeight || '', style.fontSize || '', style.fontFamily || ''].join(' ') || textContain.DEFAULT_FONT;\n  var verticalAlign = getVerticalAlignForSvg(style.textVerticalAlign);\n  textRect = textContain.getBoundingRect(text, font, align, verticalAlign);\n  var lineHeight = textRect.lineHeight; // Text position represented by coord\n\n  if (textPosition instanceof Array) {\n    x = rect.x + textPosition[0];\n    y = rect.y + textPosition[1];\n  } else {\n    var newPos = textContain.adjustTextPositionOnRect(textPosition, rect, distance);\n    x = newPos.x;\n    y = newPos.y;\n    verticalAlign = getVerticalAlignForSvg(newPos.textVerticalAlign);\n    align = newPos.textAlign;\n  }\n\n  attr(textSvgEl, 'alignment-baseline', verticalAlign);\n\n  if (font) {\n    textSvgEl.style.font = font;\n  }\n\n  var textPadding = style.textPadding; // Make baseline top\n\n  attr(textSvgEl, 'x', x);\n  attr(textSvgEl, 'y', y);\n  var textLines = text.split('\\n');\n  var nTextLines = textLines.length;\n  var textAnchor = align; // PENDING\n\n  if (textAnchor === 'left') {\n    textAnchor = 'start';\n    textPadding && (x += textPadding[3]);\n  } else if (textAnchor === 'right') {\n    textAnchor = 'end';\n    textPadding && (x -= textPadding[1]);\n  } else if (textAnchor === 'center') {\n    textAnchor = 'middle';\n    textPadding && (x += (textPadding[3] - textPadding[1]) / 2);\n  }\n\n  var dy = 0;\n\n  if (verticalAlign === 'baseline') {\n    dy = -textRect.height + lineHeight;\n    textPadding && (dy -= textPadding[2]);\n  } else if (verticalAlign === 'middle') {\n    dy = (-textRect.height + lineHeight) / 2;\n    textPadding && (y += (textPadding[0] - textPadding[2]) / 2);\n  } else {\n    textPadding && (dy += textPadding[0]);\n  } // Font may affect position of each tspan elements\n\n\n  if (el.__text !== text || el.__textFont !== font) {\n    var tspanList = el.__tspanList || [];\n    el.__tspanList = tspanList;\n\n    for (var i = 0; i < nTextLines; i++) {\n      // Using cached tspan elements\n      var tspan = tspanList[i];\n\n      if (!tspan) {\n        tspan = tspanList[i] = createElement('tspan');\n        textSvgEl.appendChild(tspan);\n        attr(tspan, 'alignment-baseline', verticalAlign);\n        attr(tspan, 'text-anchor', textAnchor);\n      } else {\n        tspan.innerHTML = '';\n      }\n\n      attr(tspan, 'x', x);\n      attr(tspan, 'y', y + i * lineHeight + dy);\n      tspan.appendChild(document.createTextNode(textLines[i]));\n    } // Remove unsed tspan elements\n\n\n    for (; i < tspanList.length; i++) {\n      textSvgEl.removeChild(tspanList[i]);\n    }\n\n    tspanList.length = nTextLines;\n    el.__text = text;\n    el.__textFont = font;\n  } else if (el.__tspanList.length) {\n    // Update span x and y\n    var len = el.__tspanList.length;\n\n    for (var i = 0; i < len; ++i) {\n      var tspan = el.__tspanList[i];\n\n      if (tspan) {\n        attr(tspan, 'x', x);\n        attr(tspan, 'y', y + i * lineHeight + dy);\n      }\n    }\n  }\n};\n\nfunction getVerticalAlignForSvg(verticalAlign) {\n  if (verticalAlign === 'middle') {\n    return 'middle';\n  } else if (verticalAlign === 'bottom') {\n    return 'baseline';\n  } else {\n    return 'hanging';\n  }\n}\n\nsvgText.drawRectText = svgTextDrawRectText;\n\nsvgText.brush = function (el) {\n  var style = el.style;\n\n  if (style.text != null) {\n    // 强制设置 textPosition\n    style.textPosition = [0, 0];\n    svgTextDrawRectText(el, {\n      x: style.x || 0,\n      y: style.y || 0,\n      width: 0,\n      height: 0\n    }, el.getBoundingRect());\n  }\n};\n\nexports.path = svgPath;\nexports.image = svgImage;\nexports.text = svgText;"]},"metadata":{},"sourceType":"script"}