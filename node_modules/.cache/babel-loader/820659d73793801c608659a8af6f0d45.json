{"ast":null,"code":"var echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar textContain = require(\"zrender/lib/contain/text\");\n\nvar featureManager = require(\"./featureManager\");\n\nvar graphic = require(\"../../util/graphic\");\n\nvar Model = require(\"../../model/Model\");\n\nvar DataDiffer = require(\"../../data/DataDiffer\");\n\nvar listComponentHelper = require(\"../helper/listComponent\");\n\nvar _default = echarts.extendComponentView({\n  type: 'toolbox',\n  render: function (toolboxModel, ecModel, api, payload) {\n    var group = this.group;\n    group.removeAll();\n\n    if (!toolboxModel.get('show')) {\n      return;\n    }\n\n    var itemSize = +toolboxModel.get('itemSize');\n    var featureOpts = toolboxModel.get('feature') || {};\n    var features = this._features || (this._features = {});\n    var featureNames = [];\n    zrUtil.each(featureOpts, function (opt, name) {\n      featureNames.push(name);\n    });\n    new DataDiffer(this._featureNames || [], featureNames).add(processFeature).update(processFeature).remove(zrUtil.curry(processFeature, null)).execute(); // Keep for diff.\n\n    this._featureNames = featureNames;\n\n    function processFeature(newIndex, oldIndex) {\n      var featureName = featureNames[newIndex];\n      var oldName = featureNames[oldIndex];\n      var featureOpt = featureOpts[featureName];\n      var featureModel = new Model(featureOpt, toolboxModel, toolboxModel.ecModel);\n      var feature;\n\n      if (featureName && !oldName) {\n        // Create\n        if (isUserFeatureName(featureName)) {\n          feature = {\n            model: featureModel,\n            onclick: featureModel.option.onclick,\n            featureName: featureName\n          };\n        } else {\n          var Feature = featureManager.get(featureName);\n\n          if (!Feature) {\n            return;\n          }\n\n          feature = new Feature(featureModel, ecModel, api);\n        }\n\n        features[featureName] = feature;\n      } else {\n        feature = features[oldName]; // If feature does not exsit.\n\n        if (!feature) {\n          return;\n        }\n\n        feature.model = featureModel;\n        feature.ecModel = ecModel;\n        feature.api = api;\n      }\n\n      if (!featureName && oldName) {\n        feature.dispose && feature.dispose(ecModel, api);\n        return;\n      }\n\n      if (!featureModel.get('show') || feature.unusable) {\n        feature.remove && feature.remove(ecModel, api);\n        return;\n      }\n\n      createIconPaths(featureModel, feature, featureName);\n\n      featureModel.setIconStatus = function (iconName, status) {\n        var option = this.option;\n        var iconPaths = this.iconPaths;\n        option.iconStatus = option.iconStatus || {};\n        option.iconStatus[iconName] = status; // FIXME\n\n        iconPaths[iconName] && iconPaths[iconName].trigger(status);\n      };\n\n      if (feature.render) {\n        feature.render(featureModel, ecModel, api, payload);\n      }\n    }\n\n    function createIconPaths(featureModel, feature, featureName) {\n      var iconStyleModel = featureModel.getModel('iconStyle'); // If one feature has mutiple icon. they are orginaized as\n      // {\n      //     icon: {\n      //         foo: '',\n      //         bar: ''\n      //     },\n      //     title: {\n      //         foo: '',\n      //         bar: ''\n      //     }\n      // }\n\n      var icons = feature.getIcons ? feature.getIcons() : featureModel.get('icon');\n      var titles = featureModel.get('title') || {};\n\n      if (typeof icons === 'string') {\n        var icon = icons;\n        var title = titles;\n        icons = {};\n        titles = {};\n        icons[featureName] = icon;\n        titles[featureName] = title;\n      }\n\n      var iconPaths = featureModel.iconPaths = {};\n      zrUtil.each(icons, function (iconStr, iconName) {\n        var path = graphic.createIcon(iconStr, {}, {\n          x: -itemSize / 2,\n          y: -itemSize / 2,\n          width: itemSize,\n          height: itemSize\n        });\n        path.setStyle(iconStyleModel.getModel('normal').getItemStyle());\n        path.hoverStyle = iconStyleModel.getModel('emphasis').getItemStyle();\n        graphic.setHoverStyle(path);\n\n        if (toolboxModel.get('showTitle')) {\n          path.__title = titles[iconName];\n          path.on('mouseover', function () {\n            // Should not reuse above hoverStyle, which might be modified.\n            var hoverStyle = iconStyleModel.getModel('emphasis').getItemStyle();\n            path.setStyle({\n              text: titles[iconName],\n              textPosition: hoverStyle.textPosition || 'bottom',\n              textFill: hoverStyle.fill || hoverStyle.stroke || '#000',\n              textAlign: hoverStyle.textAlign || 'center'\n            });\n          }).on('mouseout', function () {\n            path.setStyle({\n              textFill: null\n            });\n          });\n        }\n\n        path.trigger(featureModel.get('iconStatus.' + iconName) || 'normal');\n        group.add(path);\n        path.on('click', zrUtil.bind(feature.onclick, feature, ecModel, api, iconName));\n        iconPaths[iconName] = path;\n      });\n    }\n\n    listComponentHelper.layout(group, toolboxModel, api); // Render background after group is layout\n    // FIXME\n\n    group.add(listComponentHelper.makeBackground(group.getBoundingRect(), toolboxModel)); // Adjust icon title positions to avoid them out of screen\n\n    group.eachChild(function (icon) {\n      var titleText = icon.__title;\n      var hoverStyle = icon.hoverStyle; // May be background element\n\n      if (hoverStyle && titleText) {\n        var rect = textContain.getBoundingRect(titleText, textContain.makeFont(hoverStyle));\n        var offsetX = icon.position[0] + group.position[0];\n        var offsetY = icon.position[1] + group.position[1] + itemSize;\n        var needPutOnTop = false;\n\n        if (offsetY + rect.height > api.getHeight()) {\n          hoverStyle.textPosition = 'top';\n          needPutOnTop = true;\n        }\n\n        var topOffset = needPutOnTop ? -5 - rect.height : itemSize + 8;\n\n        if (offsetX + rect.width / 2 > api.getWidth()) {\n          hoverStyle.textPosition = ['100%', topOffset];\n          hoverStyle.textAlign = 'right';\n        } else if (offsetX - rect.width / 2 < 0) {\n          hoverStyle.textPosition = [0, topOffset];\n          hoverStyle.textAlign = 'left';\n        }\n      }\n    });\n  },\n  updateView: function (toolboxModel, ecModel, api, payload) {\n    zrUtil.each(this._features, function (feature) {\n      feature.updateView && feature.updateView(feature.model, ecModel, api, payload);\n    });\n  },\n  updateLayout: function (toolboxModel, ecModel, api, payload) {\n    zrUtil.each(this._features, function (feature) {\n      feature.updateLayout && feature.updateLayout(feature.model, ecModel, api, payload);\n    });\n  },\n  remove: function (ecModel, api) {\n    zrUtil.each(this._features, function (feature) {\n      feature.remove && feature.remove(ecModel, api);\n    });\n    this.group.removeAll();\n  },\n  dispose: function (ecModel, api) {\n    zrUtil.each(this._features, function (feature) {\n      feature.dispose && feature.dispose(ecModel, api);\n    });\n  }\n});\n\nfunction isUserFeatureName(featureName) {\n  return featureName.indexOf('my') === 0;\n}\n\nmodule.exports = _default;","map":{"version":3,"sources":["/home/martin/Escritorio/Taller de Integracion/Tarea3-TallerDeIntegracion/node_modules/react-echarts/node_modules/echarts/lib/component/toolbox/ToolboxView.js"],"names":["echarts","require","zrUtil","textContain","featureManager","graphic","Model","DataDiffer","listComponentHelper","_default","extendComponentView","type","render","toolboxModel","ecModel","api","payload","group","removeAll","get","itemSize","featureOpts","features","_features","featureNames","each","opt","name","push","_featureNames","add","processFeature","update","remove","curry","execute","newIndex","oldIndex","featureName","oldName","featureOpt","featureModel","feature","isUserFeatureName","model","onclick","option","Feature","dispose","unusable","createIconPaths","setIconStatus","iconName","status","iconPaths","iconStatus","trigger","iconStyleModel","getModel","icons","getIcons","titles","icon","title","iconStr","path","createIcon","x","y","width","height","setStyle","getItemStyle","hoverStyle","setHoverStyle","__title","on","text","textPosition","textFill","fill","stroke","textAlign","bind","layout","makeBackground","getBoundingRect","eachChild","titleText","rect","makeFont","offsetX","position","offsetY","needPutOnTop","getHeight","topOffset","getWidth","updateView","updateLayout","indexOf","module","exports"],"mappings":"AAAA,IAAIA,OAAO,GAAGC,OAAO,CAAC,eAAD,CAArB;;AAEA,IAAIC,MAAM,GAAGD,OAAO,CAAC,uBAAD,CAApB;;AAEA,IAAIE,WAAW,GAAGF,OAAO,CAAC,0BAAD,CAAzB;;AAEA,IAAIG,cAAc,GAAGH,OAAO,CAAC,kBAAD,CAA5B;;AAEA,IAAII,OAAO,GAAGJ,OAAO,CAAC,oBAAD,CAArB;;AAEA,IAAIK,KAAK,GAAGL,OAAO,CAAC,mBAAD,CAAnB;;AAEA,IAAIM,UAAU,GAAGN,OAAO,CAAC,uBAAD,CAAxB;;AAEA,IAAIO,mBAAmB,GAAGP,OAAO,CAAC,yBAAD,CAAjC;;AAEA,IAAIQ,QAAQ,GAAGT,OAAO,CAACU,mBAAR,CAA4B;AACzCC,EAAAA,IAAI,EAAE,SADmC;AAEzCC,EAAAA,MAAM,EAAE,UAAUC,YAAV,EAAwBC,OAAxB,EAAiCC,GAAjC,EAAsCC,OAAtC,EAA+C;AACrD,QAAIC,KAAK,GAAG,KAAKA,KAAjB;AACAA,IAAAA,KAAK,CAACC,SAAN;;AAEA,QAAI,CAACL,YAAY,CAACM,GAAb,CAAiB,MAAjB,CAAL,EAA+B;AAC7B;AACD;;AAED,QAAIC,QAAQ,GAAG,CAACP,YAAY,CAACM,GAAb,CAAiB,UAAjB,CAAhB;AACA,QAAIE,WAAW,GAAGR,YAAY,CAACM,GAAb,CAAiB,SAAjB,KAA+B,EAAjD;AACA,QAAIG,QAAQ,GAAG,KAAKC,SAAL,KAAmB,KAAKA,SAAL,GAAiB,EAApC,CAAf;AACA,QAAIC,YAAY,GAAG,EAAnB;AACAtB,IAAAA,MAAM,CAACuB,IAAP,CAAYJ,WAAZ,EAAyB,UAAUK,GAAV,EAAeC,IAAf,EAAqB;AAC5CH,MAAAA,YAAY,CAACI,IAAb,CAAkBD,IAAlB;AACD,KAFD;AAGA,QAAIpB,UAAJ,CAAe,KAAKsB,aAAL,IAAsB,EAArC,EAAyCL,YAAzC,EAAuDM,GAAvD,CAA2DC,cAA3D,EAA2EC,MAA3E,CAAkFD,cAAlF,EAAkGE,MAAlG,CAAyG/B,MAAM,CAACgC,KAAP,CAAaH,cAAb,EAA6B,IAA7B,CAAzG,EAA6II,OAA7I,GAfqD,CAemG;;AAExJ,SAAKN,aAAL,GAAqBL,YAArB;;AAEA,aAASO,cAAT,CAAwBK,QAAxB,EAAkCC,QAAlC,EAA4C;AAC1C,UAAIC,WAAW,GAAGd,YAAY,CAACY,QAAD,CAA9B;AACA,UAAIG,OAAO,GAAGf,YAAY,CAACa,QAAD,CAA1B;AACA,UAAIG,UAAU,GAAGnB,WAAW,CAACiB,WAAD,CAA5B;AACA,UAAIG,YAAY,GAAG,IAAInC,KAAJ,CAAUkC,UAAV,EAAsB3B,YAAtB,EAAoCA,YAAY,CAACC,OAAjD,CAAnB;AACA,UAAI4B,OAAJ;;AAEA,UAAIJ,WAAW,IAAI,CAACC,OAApB,EAA6B;AAC3B;AACA,YAAII,iBAAiB,CAACL,WAAD,CAArB,EAAoC;AAClCI,UAAAA,OAAO,GAAG;AACRE,YAAAA,KAAK,EAAEH,YADC;AAERI,YAAAA,OAAO,EAAEJ,YAAY,CAACK,MAAb,CAAoBD,OAFrB;AAGRP,YAAAA,WAAW,EAAEA;AAHL,WAAV;AAKD,SAND,MAMO;AACL,cAAIS,OAAO,GAAG3C,cAAc,CAACe,GAAf,CAAmBmB,WAAnB,CAAd;;AAEA,cAAI,CAACS,OAAL,EAAc;AACZ;AACD;;AAEDL,UAAAA,OAAO,GAAG,IAAIK,OAAJ,CAAYN,YAAZ,EAA0B3B,OAA1B,EAAmCC,GAAnC,CAAV;AACD;;AAEDO,QAAAA,QAAQ,CAACgB,WAAD,CAAR,GAAwBI,OAAxB;AACD,OAnBD,MAmBO;AACLA,QAAAA,OAAO,GAAGpB,QAAQ,CAACiB,OAAD,CAAlB,CADK,CACwB;;AAE7B,YAAI,CAACG,OAAL,EAAc;AACZ;AACD;;AAEDA,QAAAA,OAAO,CAACE,KAAR,GAAgBH,YAAhB;AACAC,QAAAA,OAAO,CAAC5B,OAAR,GAAkBA,OAAlB;AACA4B,QAAAA,OAAO,CAAC3B,GAAR,GAAcA,GAAd;AACD;;AAED,UAAI,CAACuB,WAAD,IAAgBC,OAApB,EAA6B;AAC3BG,QAAAA,OAAO,CAACM,OAAR,IAAmBN,OAAO,CAACM,OAAR,CAAgBlC,OAAhB,EAAyBC,GAAzB,CAAnB;AACA;AACD;;AAED,UAAI,CAAC0B,YAAY,CAACtB,GAAb,CAAiB,MAAjB,CAAD,IAA6BuB,OAAO,CAACO,QAAzC,EAAmD;AACjDP,QAAAA,OAAO,CAACT,MAAR,IAAkBS,OAAO,CAACT,MAAR,CAAenB,OAAf,EAAwBC,GAAxB,CAAlB;AACA;AACD;;AAEDmC,MAAAA,eAAe,CAACT,YAAD,EAAeC,OAAf,EAAwBJ,WAAxB,CAAf;;AAEAG,MAAAA,YAAY,CAACU,aAAb,GAA6B,UAAUC,QAAV,EAAoBC,MAApB,EAA4B;AACvD,YAAIP,MAAM,GAAG,KAAKA,MAAlB;AACA,YAAIQ,SAAS,GAAG,KAAKA,SAArB;AACAR,QAAAA,MAAM,CAACS,UAAP,GAAoBT,MAAM,CAACS,UAAP,IAAqB,EAAzC;AACAT,QAAAA,MAAM,CAACS,UAAP,CAAkBH,QAAlB,IAA8BC,MAA9B,CAJuD,CAIjB;;AAEtCC,QAAAA,SAAS,CAACF,QAAD,CAAT,IAAuBE,SAAS,CAACF,QAAD,CAAT,CAAoBI,OAApB,CAA4BH,MAA5B,CAAvB;AACD,OAPD;;AASA,UAAIX,OAAO,CAAC9B,MAAZ,EAAoB;AAClB8B,QAAAA,OAAO,CAAC9B,MAAR,CAAe6B,YAAf,EAA6B3B,OAA7B,EAAsCC,GAAtC,EAA2CC,OAA3C;AACD;AACF;;AAED,aAASkC,eAAT,CAAyBT,YAAzB,EAAuCC,OAAvC,EAAgDJ,WAAhD,EAA6D;AAC3D,UAAImB,cAAc,GAAGhB,YAAY,CAACiB,QAAb,CAAsB,WAAtB,CAArB,CAD2D,CACF;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,UAAIC,KAAK,GAAGjB,OAAO,CAACkB,QAAR,GAAmBlB,OAAO,CAACkB,QAAR,EAAnB,GAAwCnB,YAAY,CAACtB,GAAb,CAAiB,MAAjB,CAApD;AACA,UAAI0C,MAAM,GAAGpB,YAAY,CAACtB,GAAb,CAAiB,OAAjB,KAA6B,EAA1C;;AAEA,UAAI,OAAOwC,KAAP,KAAiB,QAArB,EAA+B;AAC7B,YAAIG,IAAI,GAAGH,KAAX;AACA,YAAII,KAAK,GAAGF,MAAZ;AACAF,QAAAA,KAAK,GAAG,EAAR;AACAE,QAAAA,MAAM,GAAG,EAAT;AACAF,QAAAA,KAAK,CAACrB,WAAD,CAAL,GAAqBwB,IAArB;AACAD,QAAAA,MAAM,CAACvB,WAAD,CAAN,GAAsByB,KAAtB;AACD;;AAED,UAAIT,SAAS,GAAGb,YAAY,CAACa,SAAb,GAAyB,EAAzC;AACApD,MAAAA,MAAM,CAACuB,IAAP,CAAYkC,KAAZ,EAAmB,UAAUK,OAAV,EAAmBZ,QAAnB,EAA6B;AAC9C,YAAIa,IAAI,GAAG5D,OAAO,CAAC6D,UAAR,CAAmBF,OAAnB,EAA4B,EAA5B,EAAgC;AACzCG,UAAAA,CAAC,EAAE,CAAC/C,QAAD,GAAY,CAD0B;AAEzCgD,UAAAA,CAAC,EAAE,CAAChD,QAAD,GAAY,CAF0B;AAGzCiD,UAAAA,KAAK,EAAEjD,QAHkC;AAIzCkD,UAAAA,MAAM,EAAElD;AAJiC,SAAhC,CAAX;AAMA6C,QAAAA,IAAI,CAACM,QAAL,CAAcd,cAAc,CAACC,QAAf,CAAwB,QAAxB,EAAkCc,YAAlC,EAAd;AACAP,QAAAA,IAAI,CAACQ,UAAL,GAAkBhB,cAAc,CAACC,QAAf,CAAwB,UAAxB,EAAoCc,YAApC,EAAlB;AACAnE,QAAAA,OAAO,CAACqE,aAAR,CAAsBT,IAAtB;;AAEA,YAAIpD,YAAY,CAACM,GAAb,CAAiB,WAAjB,CAAJ,EAAmC;AACjC8C,UAAAA,IAAI,CAACU,OAAL,GAAed,MAAM,CAACT,QAAD,CAArB;AACAa,UAAAA,IAAI,CAACW,EAAL,CAAQ,WAAR,EAAqB,YAAY;AAC/B;AACA,gBAAIH,UAAU,GAAGhB,cAAc,CAACC,QAAf,CAAwB,UAAxB,EAAoCc,YAApC,EAAjB;AACAP,YAAAA,IAAI,CAACM,QAAL,CAAc;AACZM,cAAAA,IAAI,EAAEhB,MAAM,CAACT,QAAD,CADA;AAEZ0B,cAAAA,YAAY,EAAEL,UAAU,CAACK,YAAX,IAA2B,QAF7B;AAGZC,cAAAA,QAAQ,EAAEN,UAAU,CAACO,IAAX,IAAmBP,UAAU,CAACQ,MAA9B,IAAwC,MAHtC;AAIZC,cAAAA,SAAS,EAAET,UAAU,CAACS,SAAX,IAAwB;AAJvB,aAAd;AAMD,WATD,EASGN,EATH,CASM,UATN,EASkB,YAAY;AAC5BX,YAAAA,IAAI,CAACM,QAAL,CAAc;AACZQ,cAAAA,QAAQ,EAAE;AADE,aAAd;AAGD,WAbD;AAcD;;AAEDd,QAAAA,IAAI,CAACT,OAAL,CAAaf,YAAY,CAACtB,GAAb,CAAiB,gBAAgBiC,QAAjC,KAA8C,QAA3D;AACAnC,QAAAA,KAAK,CAACa,GAAN,CAAUmC,IAAV;AACAA,QAAAA,IAAI,CAACW,EAAL,CAAQ,OAAR,EAAiB1E,MAAM,CAACiF,IAAP,CAAYzC,OAAO,CAACG,OAApB,EAA6BH,OAA7B,EAAsC5B,OAAtC,EAA+CC,GAA/C,EAAoDqC,QAApD,CAAjB;AACAE,QAAAA,SAAS,CAACF,QAAD,CAAT,GAAsBa,IAAtB;AACD,OAjCD;AAkCD;;AAEDzD,IAAAA,mBAAmB,CAAC4E,MAApB,CAA2BnE,KAA3B,EAAkCJ,YAAlC,EAAgDE,GAAhD,EAjJqD,CAiJC;AACtD;;AAEAE,IAAAA,KAAK,CAACa,GAAN,CAAUtB,mBAAmB,CAAC6E,cAApB,CAAmCpE,KAAK,CAACqE,eAAN,EAAnC,EAA4DzE,YAA5D,CAAV,EApJqD,CAoJiC;;AAEtFI,IAAAA,KAAK,CAACsE,SAAN,CAAgB,UAAUzB,IAAV,EAAgB;AAC9B,UAAI0B,SAAS,GAAG1B,IAAI,CAACa,OAArB;AACA,UAAIF,UAAU,GAAGX,IAAI,CAACW,UAAtB,CAF8B,CAEI;;AAElC,UAAIA,UAAU,IAAIe,SAAlB,EAA6B;AAC3B,YAAIC,IAAI,GAAGtF,WAAW,CAACmF,eAAZ,CAA4BE,SAA5B,EAAuCrF,WAAW,CAACuF,QAAZ,CAAqBjB,UAArB,CAAvC,CAAX;AACA,YAAIkB,OAAO,GAAG7B,IAAI,CAAC8B,QAAL,CAAc,CAAd,IAAmB3E,KAAK,CAAC2E,QAAN,CAAe,CAAf,CAAjC;AACA,YAAIC,OAAO,GAAG/B,IAAI,CAAC8B,QAAL,CAAc,CAAd,IAAmB3E,KAAK,CAAC2E,QAAN,CAAe,CAAf,CAAnB,GAAuCxE,QAArD;AACA,YAAI0E,YAAY,GAAG,KAAnB;;AAEA,YAAID,OAAO,GAAGJ,IAAI,CAACnB,MAAf,GAAwBvD,GAAG,CAACgF,SAAJ,EAA5B,EAA6C;AAC3CtB,UAAAA,UAAU,CAACK,YAAX,GAA0B,KAA1B;AACAgB,UAAAA,YAAY,GAAG,IAAf;AACD;;AAED,YAAIE,SAAS,GAAGF,YAAY,GAAG,CAAC,CAAD,GAAKL,IAAI,CAACnB,MAAb,GAAsBlD,QAAQ,GAAG,CAA7D;;AAEA,YAAIuE,OAAO,GAAGF,IAAI,CAACpB,KAAL,GAAa,CAAvB,GAA2BtD,GAAG,CAACkF,QAAJ,EAA/B,EAA+C;AAC7CxB,UAAAA,UAAU,CAACK,YAAX,GAA0B,CAAC,MAAD,EAASkB,SAAT,CAA1B;AACAvB,UAAAA,UAAU,CAACS,SAAX,GAAuB,OAAvB;AACD,SAHD,MAGO,IAAIS,OAAO,GAAGF,IAAI,CAACpB,KAAL,GAAa,CAAvB,GAA2B,CAA/B,EAAkC;AACvCI,UAAAA,UAAU,CAACK,YAAX,GAA0B,CAAC,CAAD,EAAIkB,SAAJ,CAA1B;AACAvB,UAAAA,UAAU,CAACS,SAAX,GAAuB,MAAvB;AACD;AACF;AACF,KAzBD;AA0BD,GAlLwC;AAmLzCgB,EAAAA,UAAU,EAAE,UAAUrF,YAAV,EAAwBC,OAAxB,EAAiCC,GAAjC,EAAsCC,OAAtC,EAA+C;AACzDd,IAAAA,MAAM,CAACuB,IAAP,CAAY,KAAKF,SAAjB,EAA4B,UAAUmB,OAAV,EAAmB;AAC7CA,MAAAA,OAAO,CAACwD,UAAR,IAAsBxD,OAAO,CAACwD,UAAR,CAAmBxD,OAAO,CAACE,KAA3B,EAAkC9B,OAAlC,EAA2CC,GAA3C,EAAgDC,OAAhD,CAAtB;AACD,KAFD;AAGD,GAvLwC;AAwLzCmF,EAAAA,YAAY,EAAE,UAAUtF,YAAV,EAAwBC,OAAxB,EAAiCC,GAAjC,EAAsCC,OAAtC,EAA+C;AAC3Dd,IAAAA,MAAM,CAACuB,IAAP,CAAY,KAAKF,SAAjB,EAA4B,UAAUmB,OAAV,EAAmB;AAC7CA,MAAAA,OAAO,CAACyD,YAAR,IAAwBzD,OAAO,CAACyD,YAAR,CAAqBzD,OAAO,CAACE,KAA7B,EAAoC9B,OAApC,EAA6CC,GAA7C,EAAkDC,OAAlD,CAAxB;AACD,KAFD;AAGD,GA5LwC;AA6LzCiB,EAAAA,MAAM,EAAE,UAAUnB,OAAV,EAAmBC,GAAnB,EAAwB;AAC9Bb,IAAAA,MAAM,CAACuB,IAAP,CAAY,KAAKF,SAAjB,EAA4B,UAAUmB,OAAV,EAAmB;AAC7CA,MAAAA,OAAO,CAACT,MAAR,IAAkBS,OAAO,CAACT,MAAR,CAAenB,OAAf,EAAwBC,GAAxB,CAAlB;AACD,KAFD;AAGA,SAAKE,KAAL,CAAWC,SAAX;AACD,GAlMwC;AAmMzC8B,EAAAA,OAAO,EAAE,UAAUlC,OAAV,EAAmBC,GAAnB,EAAwB;AAC/Bb,IAAAA,MAAM,CAACuB,IAAP,CAAY,KAAKF,SAAjB,EAA4B,UAAUmB,OAAV,EAAmB;AAC7CA,MAAAA,OAAO,CAACM,OAAR,IAAmBN,OAAO,CAACM,OAAR,CAAgBlC,OAAhB,EAAyBC,GAAzB,CAAnB;AACD,KAFD;AAGD;AAvMwC,CAA5B,CAAf;;AA0MA,SAAS4B,iBAAT,CAA2BL,WAA3B,EAAwC;AACtC,SAAOA,WAAW,CAAC8D,OAAZ,CAAoB,IAApB,MAA8B,CAArC;AACD;;AAEDC,MAAM,CAACC,OAAP,GAAiB7F,QAAjB","sourcesContent":["var echarts = require(\"../../echarts\");\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar textContain = require(\"zrender/lib/contain/text\");\n\nvar featureManager = require(\"./featureManager\");\n\nvar graphic = require(\"../../util/graphic\");\n\nvar Model = require(\"../../model/Model\");\n\nvar DataDiffer = require(\"../../data/DataDiffer\");\n\nvar listComponentHelper = require(\"../helper/listComponent\");\n\nvar _default = echarts.extendComponentView({\n  type: 'toolbox',\n  render: function (toolboxModel, ecModel, api, payload) {\n    var group = this.group;\n    group.removeAll();\n\n    if (!toolboxModel.get('show')) {\n      return;\n    }\n\n    var itemSize = +toolboxModel.get('itemSize');\n    var featureOpts = toolboxModel.get('feature') || {};\n    var features = this._features || (this._features = {});\n    var featureNames = [];\n    zrUtil.each(featureOpts, function (opt, name) {\n      featureNames.push(name);\n    });\n    new DataDiffer(this._featureNames || [], featureNames).add(processFeature).update(processFeature).remove(zrUtil.curry(processFeature, null)).execute(); // Keep for diff.\n\n    this._featureNames = featureNames;\n\n    function processFeature(newIndex, oldIndex) {\n      var featureName = featureNames[newIndex];\n      var oldName = featureNames[oldIndex];\n      var featureOpt = featureOpts[featureName];\n      var featureModel = new Model(featureOpt, toolboxModel, toolboxModel.ecModel);\n      var feature;\n\n      if (featureName && !oldName) {\n        // Create\n        if (isUserFeatureName(featureName)) {\n          feature = {\n            model: featureModel,\n            onclick: featureModel.option.onclick,\n            featureName: featureName\n          };\n        } else {\n          var Feature = featureManager.get(featureName);\n\n          if (!Feature) {\n            return;\n          }\n\n          feature = new Feature(featureModel, ecModel, api);\n        }\n\n        features[featureName] = feature;\n      } else {\n        feature = features[oldName]; // If feature does not exsit.\n\n        if (!feature) {\n          return;\n        }\n\n        feature.model = featureModel;\n        feature.ecModel = ecModel;\n        feature.api = api;\n      }\n\n      if (!featureName && oldName) {\n        feature.dispose && feature.dispose(ecModel, api);\n        return;\n      }\n\n      if (!featureModel.get('show') || feature.unusable) {\n        feature.remove && feature.remove(ecModel, api);\n        return;\n      }\n\n      createIconPaths(featureModel, feature, featureName);\n\n      featureModel.setIconStatus = function (iconName, status) {\n        var option = this.option;\n        var iconPaths = this.iconPaths;\n        option.iconStatus = option.iconStatus || {};\n        option.iconStatus[iconName] = status; // FIXME\n\n        iconPaths[iconName] && iconPaths[iconName].trigger(status);\n      };\n\n      if (feature.render) {\n        feature.render(featureModel, ecModel, api, payload);\n      }\n    }\n\n    function createIconPaths(featureModel, feature, featureName) {\n      var iconStyleModel = featureModel.getModel('iconStyle'); // If one feature has mutiple icon. they are orginaized as\n      // {\n      //     icon: {\n      //         foo: '',\n      //         bar: ''\n      //     },\n      //     title: {\n      //         foo: '',\n      //         bar: ''\n      //     }\n      // }\n\n      var icons = feature.getIcons ? feature.getIcons() : featureModel.get('icon');\n      var titles = featureModel.get('title') || {};\n\n      if (typeof icons === 'string') {\n        var icon = icons;\n        var title = titles;\n        icons = {};\n        titles = {};\n        icons[featureName] = icon;\n        titles[featureName] = title;\n      }\n\n      var iconPaths = featureModel.iconPaths = {};\n      zrUtil.each(icons, function (iconStr, iconName) {\n        var path = graphic.createIcon(iconStr, {}, {\n          x: -itemSize / 2,\n          y: -itemSize / 2,\n          width: itemSize,\n          height: itemSize\n        });\n        path.setStyle(iconStyleModel.getModel('normal').getItemStyle());\n        path.hoverStyle = iconStyleModel.getModel('emphasis').getItemStyle();\n        graphic.setHoverStyle(path);\n\n        if (toolboxModel.get('showTitle')) {\n          path.__title = titles[iconName];\n          path.on('mouseover', function () {\n            // Should not reuse above hoverStyle, which might be modified.\n            var hoverStyle = iconStyleModel.getModel('emphasis').getItemStyle();\n            path.setStyle({\n              text: titles[iconName],\n              textPosition: hoverStyle.textPosition || 'bottom',\n              textFill: hoverStyle.fill || hoverStyle.stroke || '#000',\n              textAlign: hoverStyle.textAlign || 'center'\n            });\n          }).on('mouseout', function () {\n            path.setStyle({\n              textFill: null\n            });\n          });\n        }\n\n        path.trigger(featureModel.get('iconStatus.' + iconName) || 'normal');\n        group.add(path);\n        path.on('click', zrUtil.bind(feature.onclick, feature, ecModel, api, iconName));\n        iconPaths[iconName] = path;\n      });\n    }\n\n    listComponentHelper.layout(group, toolboxModel, api); // Render background after group is layout\n    // FIXME\n\n    group.add(listComponentHelper.makeBackground(group.getBoundingRect(), toolboxModel)); // Adjust icon title positions to avoid them out of screen\n\n    group.eachChild(function (icon) {\n      var titleText = icon.__title;\n      var hoverStyle = icon.hoverStyle; // May be background element\n\n      if (hoverStyle && titleText) {\n        var rect = textContain.getBoundingRect(titleText, textContain.makeFont(hoverStyle));\n        var offsetX = icon.position[0] + group.position[0];\n        var offsetY = icon.position[1] + group.position[1] + itemSize;\n        var needPutOnTop = false;\n\n        if (offsetY + rect.height > api.getHeight()) {\n          hoverStyle.textPosition = 'top';\n          needPutOnTop = true;\n        }\n\n        var topOffset = needPutOnTop ? -5 - rect.height : itemSize + 8;\n\n        if (offsetX + rect.width / 2 > api.getWidth()) {\n          hoverStyle.textPosition = ['100%', topOffset];\n          hoverStyle.textAlign = 'right';\n        } else if (offsetX - rect.width / 2 < 0) {\n          hoverStyle.textPosition = [0, topOffset];\n          hoverStyle.textAlign = 'left';\n        }\n      }\n    });\n  },\n  updateView: function (toolboxModel, ecModel, api, payload) {\n    zrUtil.each(this._features, function (feature) {\n      feature.updateView && feature.updateView(feature.model, ecModel, api, payload);\n    });\n  },\n  updateLayout: function (toolboxModel, ecModel, api, payload) {\n    zrUtil.each(this._features, function (feature) {\n      feature.updateLayout && feature.updateLayout(feature.model, ecModel, api, payload);\n    });\n  },\n  remove: function (ecModel, api) {\n    zrUtil.each(this._features, function (feature) {\n      feature.remove && feature.remove(ecModel, api);\n    });\n    this.group.removeAll();\n  },\n  dispose: function (ecModel, api) {\n    zrUtil.each(this._features, function (feature) {\n      feature.dispose && feature.dispose(ecModel, api);\n    });\n  }\n});\n\nfunction isUserFeatureName(featureName) {\n  return featureName.indexOf('my') === 0;\n}\n\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}